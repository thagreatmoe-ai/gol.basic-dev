<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>GoL Modern</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./icon-180.png">
  <meta name="theme-color" content="#7b8cff">
  <link rel="stylesheet" href="./style.css">
</head>

<script>
  /* Dev helper: make sure an old SW doesn’t cache */
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations()
      .then(list => list.forEach(r => r.unregister()))
      .catch(()=>{});
  }
</script>

<body>
  <div id="app">
    <!-- Top bar -------------------------------------------------------->
    <header class="topbar">
      <button id="hamburger" aria-label="Menu" title="Menu"><span class="ham"></span></button>
      <div class="top-title">
        <div id="topTitle">Today</div>
        <div class="sub" id="dateStr"></div>
      </div>
      <div class="top-right">
        <span class="chip">Lvl <span id="level">1</span></span>
        <span class="chip">XP <span id="xp">0</span>/<span id="xpReq">200</span></span>
        <span class="chip">T <span id="tokens">0</span></span>
      </div>
    </header>
<!-- XP strip under the header -->
<div id="xpStrip" role="progressbar" aria-label="XP to next level">
  <div class="fill"></div>
</div>
    <!-- Drawer --------------------------------------------------------->
    <aside id="drawer" aria-label="Navigation">
      <div class="drawer-header">
        <div class="avatar" id="avatarBox">L1</div>
        <div>
          <div id="userName">Mohammed</div>
          <div class="sub small">Prestige +<span id="prestigeBonus">0</span>%</div>
        </div>
      </div>
      <nav class="drawer-nav">
        <button class="nav-item" data-open="tasks">Tasks</button>
        <button class="nav-item" data-open="fields">Fields</button>
        <button class="nav-item" data-open="titles">Titles</button>
        <button class="nav-item" data-open="rewards">Rewards</button>
        <button class="nav-item" data-open="theme">Theme</button>
        <!-- add this after the Theme line -->
<!-- inside <nav class="drawer-nav"> … -->
<button class="nav-item" type="button" data-open="background">Background</button>
        <button class="nav-item" data-open="backup">Backup</button>
        <button class="nav-item" data-open="settings">Settings</button>
      </nav>
    </aside>
    <div id="backdrop" role="button" aria-label="Close menu"></div>

    <!-- Views ---------------------------------------------------------->
    <main id="views">
      <section id="view-today" class="view active">

        <!-- Top split: Resistance + Quick Session (side-by-side) -->
<div class="top-split">
  <!-- Resistance ------------------------------------------------>
  <div class="card glass compact" id="resistCard">
    <h2 style="font-size:var(--h2); margin:0 0 8px">Resistance</h2>

    <!-- iOS-style toggle -->
    <label class="switch" aria-label="Resistance toggle">
      <input id="resistToggle" type="checkbox">
      <span class="slider"></span>
    </label>

    <button id="btnProtect" class="btn alt" type="button" style="margin-top:8px">
      Protect streak today
    </button>
  </div><!-- end #resistCard -->

  <!-- Quick Session -------------------------------------------->
  <div class="card glass compact" id="quickCard">
    <h2 style="font-size:var(--h2); margin:0 0 8px">Quick Session</h2>

    <label class="stack small" style="display:flex; flex-direction:column; gap:6px; min-width:140px;">
      <span style="font-size:var(--small); color:var(--muted)">Custom mins</span>
      <input id="customMin" class="input" placeholder="20" inputmode="numeric">
    </label>

    <!-- Switch + timer on the same row -->
    <div class="sess-row">
      <label class="switch">
        <input id="sessToggle" type="checkbox" aria-label="Start/Stop session">
        <span class="slider"></span>
      </label>

      <div id="timerBox" class="sub small">Session stopped.</div>
    </div>
  </div><!-- end #quickCard -->
</div><!-- end .top-split -->

<!-- Today’s tasks ---------------------------------------------->
<div class="card" id="todayCard">
  <div class="row-between">
    <h3>Today’s Tasks</h3>
    <button class="btn alt" id="btnAddTask" type="button">+ Task</button>
  </div>
  <div id="todayTasks" class="list"></div>
</div>
      </section>

      <!-- Stats view --------------------------------------------------->
      <section id="view-stats" class="view">
        <div class="grid2">
          <div class="card">
            <h3>Overview</h3>
            <div class="kpis">
              <div><div class="kpi" id="kpiXpToday">0</div><div class="muted small">XP Today</div></div>
              <div><div class="kpi" id="kpiXpWeek">0</div><div class="muted small">XP This Week</div></div>
              <div><div class="kpi" id="kpiTokens">0</div><div class="muted small">Tokens</div></div>
              <div><div class="kpi" id="kpiStreakD">0</div><div class="muted small">Daily Streak</div></div>
            </div>
          </div>
          <div class="card">
            <h3>Fields</h3>
            <div id="fieldsList" class="list"></div>
            <div class="row gap8" style="margin-top:8px">
              <label class="stack small">
                <span>New field name</span>
                <input id="fieldName" class="input" placeholder="e.g., Fitness">
              </label>
              <button class="btn" id="btnAddField" type="button">+ Field</button>
            </div>
          </div>
        </div>
      </section>

<section id="view-history" class="view">
  <div class="card wide">
    <h3>History & Undo (7 days)</h3>
    <table class="table" id="histTable">
      <thead>
        <tr>
          <th>Date</th><th>Task</th><th>Base</th><th>Final</th><th>Tokens</th><th>Flags</th><th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

      <!-- Profile view ------------------------------------------------->
      <section id="view-profile" class="view">
        <div class="card">
          <h3>Profile</h3>
          <div class="row gap8">
            <div class="avatar big" id="avatarBig">L1</div>
            <div class="grow">
              <label class="stack small">
                <span>Display name</span>
                <input id="profName" class="input" placeholder="Your name">
              </label>
              <div class="row gap8">
                <label class="stack small">
                  <span>Avatar stage (0–5)</span>
                  <input id="profAvatar" class="input small" type="number" min="0" max="5" value="0">
                </label>
                <button class="btn alt" id="btnSaveProfile" type="button">Save</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Titles & Boosts</h3>
          <div id="titleList" class="list"></div>
          <div class="row gap8">
            <label class="stack small"><span>Title name</span><input id="titleName" class="input" placeholder="e.g., Stylish Hair"></label>
            <label class="stack small"><span>Boost %</span><input id="titleBoost" class="input small" type="number" value="5" inputmode="numeric"></label>
            <label class="stack small"><span>Scope</span>
              <select id="titleScope" class="input small">
                <option value="daily">Daily</option>
                <option value="week">Next Week</option>
                <option value="month">This Month</option>
                <option value="always">Always</option>
              </select>
            </label>
            <button class="btn" id="btnAddTitle" type="button">+ Title</button>
          </div>
        </div>

        <div class="card">
          <h3>Shop (Tokens only)</h3>
          <div id="shopList" class="list"></div>
          <div class="row gap8">
            <label class="stack small"><span>Reward name</span><input id="rewardName" class="input" placeholder="e.g., New mouse"></label>
            <label class="stack small"><span>Cost (tokens)</span><input id="rewardCost" class="input small" type="number" value="10" inputmode="numeric"></label>
            <label class="stack small"><span>Type</span>
              <select id="rewardType" class="input small">
                <option value="irl">Real-life</option>
                <option value="avatar">Avatar</option>
                <option value="cosmetic">Cosmetic</option>
                <option value="tool">Tool</option>
              </select>
            </label>
            <button class="btn" id="btnAddReward" type="button">+ Reward</button>
          </div>
        </div>

        <div class="card">
          <h3>Prestige</h3>
          <div class="muted small">Reset levels → keep permanent global bonus; avatar evolves.</div>
          <div class="row gap8">
            <label class="stack small"><span>Prestige bonus %</span><input id="prestigePct" class="input small" type="number" value="5" inputmode="numeric"></label>
            <label class="stack small"><span>Confirmation</span><input id="prestigeConfirm" class="input" placeholder="Type PRESTIGE"></label>
            <button class="btn danger" id="btnPrestige" type="button">Prestige</button>
          </div>
        </div>
      </section>
    </main>

    <!-- Tab bar ------------------------------------------------------->
    <nav id="tabbar">
      <a class="tab active" data-view="today" aria-label="Today">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M7 2h2v2h6V2h2v2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2V2Zm12 6H5v12h14V8Zm-9 3h2v2H10v-2Zm4 0h2v2h-2v-2Z"/>
        </svg>
        <span>Today</span>
      </a>

      <a class="tab" data-view="stats" aria-label="Stats">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M3 19h18v2H3v-2Zm2-8h3v6H5v-6Zm5-4h3v10h-3V7Zm5 3h3v7h-3V10Z"/>
        </svg>
        <span>Stats</span>
      </a>

<a class="tab" data-view="history">
  <!-- History / clock icon -->
  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
  <!-- Clock ring + inner cutout + hour/minute hand -->
  <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"
    d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3h-2v6h6v-2h-4V7Z"/>
</svg>
  <span>History</span>
</a>

      <a class="tab" data-view="profile" aria-label="Profile">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5Z"/>
        </svg>
        <span>Profile</span>
      </a>
    </nav>

    <div id="toast" role="status" aria-live="polite" aria-atomic="true"></div>
    <div id="sheet" class="sheet" role="dialog" aria-modal="true" aria-label="Modal"></div>

    <!-- App script -->
    <script src="app.js?v=69"></script>

    <!-- Floating “+ Task” button (Today view only) -->
    <button class="fab" id="fabAddTask" type="button" aria-label="Add task" title="Add task">+</button>
  </div>
</body>
</html>
